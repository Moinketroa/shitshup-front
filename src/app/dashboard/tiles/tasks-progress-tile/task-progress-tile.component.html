<mat-card class="task-progress-card">
    <mat-card-header>
        <mat-card-title class="task-progress-card--title">
            Process Tasks Status
        </mat-card-title>
        <mat-card-subtitle>You can track here the progress of your videos' processing</mat-card-subtitle>
    </mat-card-header>

    <mat-card-content class="task-progress-card--content">
        <ng-container [ngTemplateOutlet]="treeTable"></ng-container>
    </mat-card-content>
</mat-card>

<ng-template #treeTable>
    <p-treeTable *ngIf="taskTrees" [value]="taskTrees!"
                 [scrollable]="true" scrollHeight="flex"
                 styleClass="task-progress-tree-table">
        <ng-template pTemplate="header">
            <tr>
                <th class="task-progress-tree-table--cell">Name</th>
                <th class="task-progress-tree-table--cell task-progress-tree-table--progress--header">
                    Progress
                </th>
                <th class="task-progress-tree-table--cell task-progress-tree-table--status--header">
                    Status
                </th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowNode let-rowData="rowData">
            <tr [ttRow]="rowNode">
                <td class="task-progress-tree-table--cell" [colSpan]="(rowData.progress !== 1 && !rowData.hasFailed) ? 1 : 2">
                    <p-treeTableToggler [rowNode]="rowNode"></p-treeTableToggler>
                    {{ rowData.label }}
                </td>
                <td *ngIf="(rowData.progress !== 1 && !rowData.hasFailed)"
                    class="task-progress-tree-table--cell task-progress-tree-table--progress--cell">
                    <mat-progress-bar mode="determinate" color="accent" [value]="rowData.progress * 100">
                    </mat-progress-bar>
                </td>
                <td class="task-progress-tree-table--cell task-progress-tree-table--status--cell">
                    <ng-container [ngTemplateOutlet]="statusIcon"
                                  [ngTemplateOutletContext]="{
                                    progress: rowData.progress,
                                    hasFailed: rowData.hasFailed,
                                  }">
                    </ng-container>
                </td>
            </tr>
        </ng-template>
    </p-treeTable>
</ng-template>

<ng-template #statusIcon let-progress="progress" let-hasFailed="hasFailed">
    <ng-template [ngIf]="hasFailed" [ngIfElse]="nominalStatus">
        <mat-icon class="fail-icon">close</mat-icon>
    </ng-template>

    <ng-template #nominalStatus>
        <ng-template [ngIf]="progress === 1" [ngIfElse]="inProgress">
            <mat-icon class="done-icon">done</mat-icon>
        </ng-template>

        <ng-template #inProgress>
            <mat-icon class="in-progress-icon">pending</mat-icon>
        </ng-template>
    </ng-template>
</ng-template>
